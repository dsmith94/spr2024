function detectMobile(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))}function look(e){Game.actions.look={preview:"Look Around",action:e}}function check(e){Game.actions.continue={preview:"Continue",action:e}}function use(e,t){Game.actions.use={preview:e,action:t}}function talk(e,t){Game.actions.talk={preview:e,action:t}}function help(e,t){Game.actions.help={preview:e,action:t}}function north(e,t){Game.actions.north={preview:e,action:t}}function west(e,t){Game.actions.west={preview:e,action:t}}function east(e,t){Game.actions.east={preview:e,action:t}}function south(e,t){Game.actions.south={preview:e,action:t}}function header(e){Game.header=e}function desc(e){Game.desc=e}function showDesc(){msg(Game.desc())}function set_game_action(e){if(Game.actions[e])try{var t=Game.actions[e].preview;t&&(Game.input=t,Game.command=e,refresh())}catch{console.log(`Action ${e} not implemented`)}}function set_game_topic(e){var t;Game.topics[e]&&(t=Game.topics[e].preview)&&(Game.input=t,Game.command=e,refresh())}function topics(e){Game.topics=e}function backspace_action(){Game.input="",Game.command="",refresh()}function execute_action(){var t=document.querySelector("#console"),a=Game.input,n=Game.command;if(Game.input){t.append(previous_command_line(a));let e="";e=(Number.isInteger(n)?Game.topics:Game.actions)[n].action(),Game.input="",Game.command="",msg(e),refresh()}}function create_button(e,t,a){var n=document.createElement("div"),o=(n.className="button-group",document.createElement("button")),e=(o.className=e,o.onclick=()=>{a()},document.createElement("span")),c=(e.className="material-icons-round",document.createElement("span"));return c.className="icon",c.append(t),e.append(c),o.append(e),n.append(o),"search"===t&&n.append("Look"),"back_hand"===t&&n.append("Use"),"chat"===t&&n.append("Talk"),"help"===t&&n.append("Help"),"check"===t&&n.append("Continue"),n}function create_topic_button(e,t,a){var n=document.createElement("div"),o=(n.className="button-group",document.createElement("button"));return o.className="topic",o.onclick=()=>{console.log(t),a()},o.append(e.word),n.append(o),n.append(""+(t+1)),n}function create_console_icons(e,t){var a=document.createElement("button"),n=(a.className="console",a.onclick=()=>{t()},document.createElement("span")),o=(n.className="material-icons-round",document.createElement("span"));return o.className="console-icon",o.append(e),n.append(o),a.append(n),a}function update_header(){var e,t,a=document.getElementById("header");a.innerHTML="",Game.header&&((e=document.createElement("div")).append(Game.header),(t=document.createElement("div")).append(Game.score),a.append(e),a.append(t))}function remove_control_box(){var e=document.getElementById("control-box");e&&e.remove()}function action_row(){var e=document.createElement("div"),t=(e.className="actions",create_button("action","search",()=>set_game_action("look"))),a=create_button("action","back_hand",()=>set_game_action("use")),n=create_button("action","chat",()=>set_game_action("talk")),o=create_button("action","help",()=>set_game_action("help"));return e.append(t),e.append(a),e.append(n),e.append(o),e}function direction_row(){var e=document.createElement("div"),t=(e.className="directions",create_button("direction","north",()=>set_game_action("north"))),a=create_button("direction","south",()=>set_game_action("south")),n=create_button("direction","west",()=>set_game_action("west")),o=create_button("direction","east",()=>set_game_action("east"));return e.append(t),e.append(a),e.append(n),e.append(o),e}function topic_row(){var t=document.createElement("div");t.className="topics";for(let e=0;e<Game.topics.length;e+=1){var a=create_topic_button(Game.topics[e],e,()=>set_game_topic(e));t.append(a)}return t}function check_row(){var e=document.createElement("div"),t=(e.className="directions",create_button("direction","check",()=>{Game.input="",Game.command="",msg(Game.actions.continue.action()),refresh()}));return e.append(t),Game.actions.help&&(t=create_button("action","help",()=>set_game_action("help")),e.append(t)),e}function command_line(){var e,t=document.createElement("span"),a=(t.className="material-icons-round",document.createElement("span")),a=(a.className="parser",a.innerText="chevron_right",t.append(a),document.createElement("div")),n=(a.className="command-inner",document.createElement("div")),o=(n.className="command-inner",document.createElement("div")),t=(o.className="command-line",a.append(t),document.createElement("div"));return t.className="cursor",t.innerHTML="&block;",a.append(Game.input),a.append(t),""!==Game.input&&(t=create_console_icons("backspace",()=>backspace_action()),e=create_console_icons("keyboard_return",()=>execute_action()),n.append(t),n.append(e)),o.append(a),o.append(n),o}function previous_command_line(e){var t=document.createElement("span"),a=(t.className="material-icons-round",document.createElement("span")),a=(a.className="parser",a.innerText="chevron_right",t.append(a),document.createElement("div")),n=(a.className="command-inner",document.createElement("div"));return n.className="previous-command-line",a.append(t),a.append(e),n.append(a),n}function add_control_box(){remove_control_box();var e,t=document.querySelector("#console"),a=document.createElement("div"),n=(a.className="control-box",a.id="control-box",command_line());a.append(n),Game.actions.continue?(n=check_row(),a.append(n)):0<Game.topics.length?(n=topic_row(),a.append(n)):(n=action_row(),e=direction_row(),a.append(n),a.append(e)),t.append(a)}function msg(e){var t=document.querySelector("#console"),a=document.createElement("div");a.className="msg",e=(e=(e=(e=(e=`<p>${(e=(e=SmartyPants(e)).split("\n\n")).join("</p><p>")}</p>`).replaceAll("{<","<b>")).replaceAll(">}","</b>")).replaceAll("<<","<i>")).replaceAll(">>","</i>"),a.innerHTML=e,t.append(a)}function go(e){Game.location=e,Game.actions={},Game.rooms[e](),""!==Game.header&&msg(`<div class="room-header"><h3>${Game.header}</h3></div>`),showDesc(),refresh()}function refresh(){update_header(),add_control_box(),window.scrollTo(0,document.body.scrollHeight)}function start(){go("title"),refresh()}function shuffle(e){let t=e.length,a;for(;0!=t;)a=Math.floor(Math.random()*t),t--,[e[t],e[a]]=[e[a],e[t]];return e}addEventListener("DOMContentLoaded",()=>{start()}),window.addEventListener("keydown",function(e){-1<["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code)&&e.preventDefault()},!1),addEventListener("keyup",e=>{switch(e.key.toLocaleLowerCase()){case"l":return void set_game_action("look");case"u":return void set_game_action("use");case"t":return void set_game_action("talk");case"u":return void set_game_action("use");case"h":return void set_game_action("help");case"1":return void set_game_topic(1);case"2":return void set_game_topic(2);case"3":return void set_game_topic(3);case"4":return void set_game_topic(4);case"5":return void set_game_topic(5);case"6":return void set_game_topic(6);case"7":return void set_game_topic(7);case"8":return void set_game_topic(8);case"9":return void set_game_topic(9);case"enter":return void execute_action();case"backspace":return void backspace_action();case"a":case"arrowleft":return void set_game_action("west");case"d":case"arrowright":return void set_game_action("east");case"w":case"arrowup":return void set_game_action("north");case"s":case"arrowdown":return void set_game_action("south")}});const tags_to_skip=/<(\/?)(?:pre|code|kbd|script|math)[^>]*>/i,SmartyPants=(e="",t="1")=>{var a,n,o,c,r,s=0;if("0"===(t="number"==typeof t?t.toString():t.replace(/\s/g,"")))return e;if("1"===t)c=o=n=a=1;else if("2"===t)o=2,c=n=a=1;else if("3"===t)o=3,c=n=a=1;else if("-1"===t)r=1;else for(let e=0;e<t.length;e++){var i=t[e];"q"===i&&(a=1),"b"===i&&(n=1),"B"===i&&(n=2),"d"===i&&(o=1),"D"===i&&(o=2),"i"===i&&(o=3),"e"===i&&(c=1),"w"===i&&(s=1)}var p=_tokenize(e),l="",u=0,m="";for(let e=0;e<p.length;e++){var d=p[e];if("tag"===d[0]){l+=d[1];var g=tags_to_skip.exec(d[1]);g&&(u="/"===g[1]?0:1)}else{let e=d[1];g=e.substring(e.length-1,e.length);u||(e=ProcessEscapes(e),s&&(e=e.replace(/$quot;/g,'"')),o&&(1===o&&(e=EducateDashes(e)),2===o&&(e=EducateDashesOldSchool(e)),3===o)&&(e=EducateDashesOldSchoolInverted(e)),c&&(e=EducateEllipses(e)),n&&(e=EducateBackticks(e),2===n)&&(e=EducateSingleBackticks(e)),a&&(e="'"===e?/\S/.test(m)?"&#8217;":"&#8216;":'"'===e?/\S/.test(m)?"&#8221;":"&#8220;":EducateQuotes(e)),r&&(e=StupefyEntities(e))),m=g,l+=e}}return l},SmartQuotes=(e="",t="1")=>{if("0"===(t="number"==typeof t?t.toString():t.replace(/\s/g,"")))return e;var t=0,a=(/>['"]$/.test(e)&&(t=1,e+=" "),_tokenize(e)),n="",o=0,c="";for(let e=0;e<a.length;e++){var r=a[e];if("tag"===r[0]){n+=r[1];var s=tags_to_skip.exec(r[1]);s&&(o="/"===s[1]?0:1)}else{let e=r[1];s=e.substring(e.length-1,e.length);o||(e="'"===(e=ProcessEscapes(e))?/\S/.test(c)?"&#8217;":"&#8216;":'"'===e?/\S/.test(c)?"&#8221;":"&#8220;":EducateQuotes(e)),c=s,n+=e}}return n=t?n.replace(/ $/,""):n},SmartDashes=(e="",t="1")=>{var a=EducateDashes;if("0"===(t="number"==typeof t?t.toString():t.replace(/\s/g,"")))return e;"2"===t?a=EducateDashesOldSchool:"3"===t&&(a=EducateDashesOldSchoolInverted);var n=_tokenize(e),o="",c=0;for(let e=0;e<n.length;e++){var r=n[e];if("tag"===r[0]){o+=r[1];var s=tags_to_skip.exec(r[1]);s&&(c="/"===s[1]?0:1)}else{let e=r[1];o+=e=c?e:a(e=ProcessEscapes(e))}}return o},SmartEllipses=(e="",t="1")=>{if("0"===(t="number"==typeof t?t.toString():t.replace(/\s/g,"")))return e;var a=_tokenize(e),n="",o=0;for(let e=0;e<a.length;e++){var c=a[e];if("tag"===c[0]){n+=c[1];var r=tags_to_skip.exec(c[1]);r&&(o="/"===r[1]?0:1)}else{let e=c[1];o||(e=ProcessEscapes(e),e=EducateEllipses(e)),n+=e}}return n},EducateQuotes=e=>{var t="[!\"#$%'()*+,-./:;<=>?@[\\]^_`{|}~]",a="[^\\ \\t\\r\\n\\[\\{\\(\\-]",n="[\\ \\t\\r\\n\\[\\{\\(\\-]",o="&#8211;|&#8212;";return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(new RegExp(`^'(?=${t}\\B)`),"&#8217;")).replace(new RegExp(`^"(?=${t}\\B)`),"&#8221;")).replace(/"'(?=\w)/,"&#8220;&#8216;")).replace(/'"(?=\w)/,"&#8216;&#8220;")).replace(/'(?=\d\d)/,"&#8217;")).replace(new RegExp(`(\\s|&nbsp;|--|&[mn]dash;|${o}|&#x201[34])'(?=\\w)`,"g"),"$1&#8216;")).replace(new RegExp(`(${a})'`,"g"),"$1&#8217;")).replace(new RegExp(`(${n}?)'(?=\\s|s\\b)`,"g"),"$1&#8217;")).replace(/'/g,"&#8216;")).replace(new RegExp(`(\\s|&nbsp;|--|&[mn]dash;|${o}|&#x201[34])"(?=\\w)`,"g"),"$1&#8220;")).replace(new RegExp(`(${a})"`,"g"),"$1&#8221;")).replace(new RegExp(`(${n}?)"(?=\\s)`,"g"),"$1&#8221;")).replace(/"/g,"&#8220;")},EducateBackticks=e=>e=(e=e.replace(/``/g,"&#8220;")).replace(/''/g,"&#8221;"),EducateSingleBackticks=e=>e=(e=e.replace(/`/g,"&#8216;")).replace(/'/g,"&#8217;"),EducateDashes=e=>e=e.replace(/--/g,"&#8212;"),EducateDashesOldSchool=e=>e=(e=e.replace(/---/g,"&#8212;")).replace(/--/g,"&#8211;"),EducateDashesOldSchoolInverted=e=>e=(e=e.replace(/---/g,"&#8211;")).replace(/--/g,"&#8212;"),EducateEllipses=e=>e=(e=e.replace(/\.\.\./g,"&#8230;")).replace(/\. \. \./g,"&#8230;"),StupefyEntities=e=>e=(e=(e=(e=(e=(e=(e=e.replace(/&#8211;/g,"-")).replace(/&#8212;/g,"--")).replace(/&#8216;/g,"'")).replace(/&#8217;/g,"'")).replace(/&#8220;/g,'"')).replace(/&#8221;/g,'"')).replace(/&#8230;/g,"..."),EducateEntities=(e,t="1")=>{var a,n,o,c;if("0"!==(t="number"==typeof t?t.toString():t.replace(/\s/g,""))){if("1"===t)c=o=n=a=1;else if("2"===t)o=3,c=n=a=1;else if("3"===t)o=3,c=n=a=1;else for(let e=0;e<t.length;e++){var r=t[e];"q"===r&&(a=1),"b"===r&&(n=1),"B"===r&&(n=2),"d"===r&&(o=1),"D"===r&&(o=2),"i"===r&&(o=3),"e"===r&&(c=1)}o&&(e=(e=e.replace(/&#8211;/g,"–")).replace(/&#8212;/g,"—")),(a||n)&&(e=(e=(e=(e=e.replace(/&#8216;/g,"‘")).replace(/&#8217;/g,"’")).replace(/&#8220;/g,"“")).replace(/&#8221;/g,"”")),c&&(e=e.replace(/&#8230;/g,"…"))}return e},StupifyUTF8Char=e=>e=(e=(e=(e=(e=(e=(e=e.replace(/\u2013/g,"-")).replace(/\u2014/g,"--")).replace(/\u2018/g,"'")).replace(/\u2019/g,"'")).replace(/\u201c/g,'"')).replace(/\u201d/g,'"')).replace(/\u2026/g,"..."),ProcessEscapes=e=>e=(e=(e=(e=(e=(e=e.replace(/\\\\/g,"&#92;")).replace(/\\"/g,"&#34;")).replace(/\\'/g,"&#39;")).replace(/\\\./g,"&#46;")).replace(/\\-/g,"&#45;")).replace(/\\`/g,"&#96;"),_tokenize=e=>{for(var t=0,a=e.length,n=[],o=/<!--[\s\S]*?-->|<\?.*?\?>|<[^>]*>/g,c=null;c=o.exec(e);){t<c.index&&(r=["text",e.substring(t,c.index)],n.push(r));var r=["tag",c.toString()];n.push(r),t=o.lastIndex}return t<a&&(a=["text",e.substring(t,a)],n.push(a)),n},smartypantsu=(e="",t="1")=>{e=SmartyPants(e,t);return"-1"===(t="number"==typeof t?t.toString():t.replace(/\s/g,""))?StupifyUTF8Char(e):EducateEntities(e,t)},titleMsg=(Game.rooms.nextRoom=()=>{header("Next Room"),desc(()=>'This is the {<next>} "room".'),look(showDesc),use("Next room",()=>"This is a test."),talk("Yell",()=>"AAAAHHHHHH! That feels better."),help("Hint Please",()=>"No hint for you."),north("Leave Room",()=>go("nextRoom"))},Game.rooms.startRoom=()=>{header("Start Room"),desc(()=>'This is the <<first>> "room".'),look(showDesc),use("Next room",()=>"This is a test."),talk("Yell",()=>"AAAAHHHHHH! That feels better."),help("Hint Please",()=>"No hint for you."),north("Leave Room",()=>go("nextRoom"))},`

Welcome to

<h1>This Cave is Trying to Kill You</h1>

<h2>A game by spaceflounder</h2>

Hey, if this is your first time playing, you may want to hit the Help button.
It's a bit different here than other text-games!

`),helpMsg=`

<<This Cave is Trying to Kill You>> is an interactive short story where you are
the star! Your goal is to enter and explore the nearby cave full of treasures.
Terrible traps and monsters lurk within, so be careful! (If you do perish, don't
worry--I can mostly bring you back in one piece. Mostly.)

You can manipulate the story narrative by hitting the buttons below.
If the button has and uppercase description--Look, for example--you can press the L key on the keyboard
instead of tapping the screen or using the mouse. You can also navigate with arrow keys
(or WASD) instead of tapping arrow buttons on the screen.

`;Game.rooms.title=()=>{header(""),check(()=>go("startRoom")),help("About this Game",()=>helpMsg),desc(()=>titleMsg)};